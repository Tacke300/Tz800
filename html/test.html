<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Binance Futures Funding Rate</title>
  <style>
    body { font-family: Arial, sans-serif; background: #121212; color: #eee; padding: 20px; }
    table { border-collapse: collapse; width: 100%; max-width: 900px; margin: auto; }
    th, td { border: 1px solid #444; padding: 8px 12px; text-align: center; }
    th { background-color: #222; }
    tr:nth-child(even) { background-color: #1a1a1a; }
  </style>
</head>
<body>

<h1>Funding Rate - Binance Futures (USD-M)</h1>
<table>
  <thead>
    <tr>
      <th>Symbol</th>
      <th>Funding Rate</th>
      <th>Funding Time (UTC)</th>
    </tr>
  </thead>
  <tbody id="funding-table-body">
    <tr><td colspan="3">Loading...</td></tr>
  </tbody>
</table>

<script>
  async function fetchFundingRates() {
    const tableBody = document.getElementById('funding-table-body');
    tableBody.innerHTML = '<tr><td colspan="3">Loading...</td></tr>';

    try {
      // 1. Lấy danh sách symbol futures
      const exchangeInfoRes = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
      const exchangeInfo = await exchangeInfoRes.json();

      const symbols = exchangeInfo.symbols
        .filter(s => s.contractType === "PERPETUAL") // chỉ lấy perpetual contract
        .map(s => s.symbol);

      // Giới hạn số đồng để tránh request quá nhiều, bạn có thể tăng nếu muốn
      const limitedSymbols = symbols.slice(0, 30);

      // 2. Lấy funding rate từng symbol (latest)
      // Binance API cho phép lấy funding rate với param limit=1 lấy bản mới nhất
      // fetch funding rate từng symbol (chạy tuần tự để tránh quá tải server)
      let rows = '';

      for (const symbol of limitedSymbols) {
        const url = `https://fapi.binance.com/fapi/v1/fundingRate?symbol=${symbol}&limit=1`;
        const res = await fetch(url);
        const data = await res.json();
        if (data.length > 0) {
          const fr = parseFloat(data[0].fundingRate);
          const time = new Date(data[0].fundingTime).toUTCString();
          rows += `
            <tr>
              <td>${symbol}</td>
              <td>${(fr * 100).toFixed(5)}%</td>
              <td>${time}</td>
            </tr>`;
        }
      }

      tableBody.innerHTML = rows || '<tr><td colspan="3">No data found</td></tr>';

    } catch (error) {
      console.error(error);
      tableBody.innerHTML = `<tr><td colspan="3">Error loading data</td></tr>`;
    }
  }

  fetchFundingRates();
</script>

</body>
</html>
