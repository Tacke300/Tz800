<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Binance Balance Demo</title>
<style>
  body { font-family: Arial, sans-serif; padding: 10px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background-color: #f2f2f2; }
  #status { margin-top: 10px; color: green; }
</style>
</head>
<body>
<h2>Binance Account Balances</h2>

<div>
  <label>API Key: <input type="text" id="apiKey" style="width: 400px;" /></label><br /><br />
  <label>Secret Key: <input type="text" id="secretKey" style="width: 400px;" /></label><br /><br />
  <button onclick="main()">Load Balances</button>
</div>

<div id="status"></div>

<div id="balances" style="margin-top: 20px;">
  <h3>Balances</h3>
  <p><b>Spot USDT:</b> <span id="spot-usdt">-</span></p>
  <p><b>USDT-M Futures USDT:</b> <span id="usdm-usdt">-</span></p>
  <p><b>COIN-M Futures BTC (ví dụ):</b> <span id="coinm-btc">-</span></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
  function getTimestamp() {
    return Date.now();
  }

  function signQuery(queryString, secret) {
    return CryptoJS.HmacSHA256(queryString, secret).toString(CryptoJS.enc.Hex);
  }

  async function fetchWithSignature(baseUrl, path, apiKey, secret) {
    const timestamp = getTimestamp();
    const query = `timestamp=${timestamp}`;
    const signature = signQuery(query, secret);
    const url = `${baseUrl}${path}?${query}&signature=${signature}`;

    const res = await fetch(url, { headers: { 'X-MBX-APIKEY': apiKey } });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(`API error ${res.status}: ${text}`);
    }
    return res.json();
  }

  async function getSpotBalance(apiKey, secret) {
    return fetchWithSignature('https://api.binance.com', '/api/v3/account', apiKey, secret);
  }

  async function getUsdmBalance(apiKey, secret) {
    return fetchWithSignature('https://fapi.binance.com', '/fapi/v2/balance', apiKey, secret);
  }

  async function getCoinmBalance(apiKey, secret) {
    return fetchWithSignature('https://dapi.binance.com', '/dapi/v1/balance', apiKey, secret);
  }

  async function main() {
    const apiKey = document.getElementById('apiKey').value.trim();
    const secretKey = document.getElementById('secretKey').value.trim();
    const statusEl = document.getElementById('status');
    const spotEl = document.getElementById('spot-usdt');
    const usdmEl = document.getElementById('usdm-usdt');
    const coinmEl = document.getElementById('coinm-btc');

    if (!apiKey || !secretKey) {
      alert('Vui lòng nhập API Key và Secret Key');
      return;
    }

    statusEl.textContent = 'Đang tải dữ liệu...';
    spotEl.textContent = '-';
    usdmEl.textContent = '-';
    coinmEl.textContent = '-';

    try {
      // Spot
      const spotData = await getSpotBalance(apiKey, secretKey);
      const spotUsdt = spotData.balances.find(b => b.asset === 'USDT');
      spotEl.textContent = spotUsdt ? spotUsdt.free : '0';

      // USDT-M Futures
      const usdmData = await getUsdmBalance(apiKey, secretKey);
      const usdmUsdt = usdmData.find(b => b.asset === 'USDT');
      usdmEl.textContent = usdmUsdt ? usdmUsdt.balance : '0';

      // COIN-M Futures (ví dụ lấy số dư BTC)
      const coinmData = await getCoinmBalance(apiKey, secretKey);
      const coinmBtc = coinmData.find(b => b.asset === 'BTC');
      coinmEl.textContent = coinmBtc ? coinmBtc.balance : '0';

      statusEl.textContent = 'Đã tải dữ liệu thành công.';

    } catch (e) {
      statusEl.textContent = 'Lỗi: ' + e.message;
      console.error(e);
    }
  }
</script>

</body>
</html>
