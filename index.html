<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bot Funding Login</title>
  <style>
    /* ... giữ nguyên toàn bộ style cũ ... */

    /* Thêm style cho log console */
    #console-log {
      background: #222;
      color: #0f0;
      font-family: monospace;
      font-size: 13px;
      padding: 10px;
      height: 150px;
      overflow-y: auto;
      margin-top: 20px;
      border-radius: 8px;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>

  <!-- giữ nguyên HTML login/register như cũ -->

  <!-- Thêm khung log -->
  <div class="container" style="max-width: 400px; margin-top: 10px;">
    <h3>Console Log</h3>
    <div id="console-log"></div>
  </div>

  <script>
    const supabase = supabase.createClient(
      'https://tramnanrzruzvkehpydl.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRyYW1uYW5yenJ1enZrZWhweWRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3NTM1NTMsImV4cCI6MjA2MTMyOTU1M30.L0Ytkxi80AbYjkjpDfGyQtfyfqjfHLF98OrVce9Hi-0'
    );

    // Override console.log / error / warn để hiển thị trên web
    (function(){
      const logDiv = document.getElementById('console-log');
      ['log', 'error', 'warn'].forEach(level => {
        const original = console[level];
        console[level] = function(...args) {
          original.apply(console, args);
          const msg = args.map(a => {
            if (typeof a === 'object') {
              try { return JSON.stringify(a, null, 2); }
              catch(e) { return String(a); }
            }
            return String(a);
          }).join(' ');

          const p = document.createElement('div');
          p.textContent = `[${level.toUpperCase()}] ` + msg;
          p.style.marginBottom = '4px';
          if(level === 'error') p.style.color = '#f44';
          else if(level === 'warn') p.style.color = '#fa0';
          logDiv.appendChild(p);
          logDiv.scrollTop = logDiv.scrollHeight;
        }
      });
    })();

    // Các function hiện tại giữ nguyên
    function showRegister() {
      document.getElementById('login-box').style.display = 'none';
      document.getElementById('register-box').style.display = 'block';
    }

    function showLogin() {
      document.getElementById('login-box').style.display = 'block';
      document.getElementById('register-box').style.display = 'none';
    }

    async function register() {
      const user = document.getElementById('reg-user').value.trim();
      const pass = document.getElementById('reg-pass').value;
      const confirm = document.getElementById('reg-pass-confirm').value;

      if (user && pass && pass === confirm) {
        const { data, error } = await supabase
          .from('users')
          .insert([{ user_id: user, password: pass }]);

        console.log('register data:', data);
        console.error('register error:', error);

        if (error) {
          alert("Lỗi đăng ký: " + error.message);
        } else {
          document.getElementById('register-box').style.display = 'none';
          document.getElementById('login-box').style.display = 'block';
          document.getElementById('success-popup').style.display = 'flex';
        }
      } else {
        alert("Vui lòng điền đúng và đủ thông tin.");
      }
    }

    async function login() {
      try {
        const user = document.getElementById('login-user').value.trim();
        const pass = document.getElementById('login-pass').value;

        const { data, error } = await supabase
          .from('users')
          .select('*')
          .eq('user_id', user)
          .eq('password', pass)
          .single();

        if (error) {
          alert("Sai tài khoản hoặc mật khẩu");
          console.error(error);
          return;
        }

        if (data) {
          document.getElementById('home').style.display = 'flex';
          console.log("Đăng nhập thành công:", data);
        } else {
          alert("Sai tài khoản hoặc mật khẩu");
        }
      } catch (err) {
        alert("Có lỗi xảy ra, vui lòng thử lại.");
        console.error(err);
      }
    }

    function closePopup() {
      document.getElementById('success-popup').style.display = 'none';
    }
  </script>
</body>
</html>
