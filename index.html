<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý Telegram ID</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { padding: 8px; font-size: 16px; margin-right: 8px; }
    table { width: 50%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>

<h1>Gửi Telegram ID lên Supabase</h1>
<input type="text" id="telegram_id_input" placeholder="Nhập Telegram ID">
<button onclick="sendTelegramID()">Gửi ID</button>

<h2>Danh sách Telegram ID đã lưu</h2>
<table id="telegram_ids_table">
  <thead>
    <tr>
      <th>#</th>
      <th>Telegram ID</th>
    </tr>
  </thead>
  <tbody>
    <!-- Dữ liệu sẽ được thêm tự động vào đây -->
  </tbody>
</table>

<script>
  // Kết nối với Supabase
  const supabaseUrl = 'https://xxxx.supabase.co'; // <-- Thay bằng Supabase URL của anh
  const supabaseKey = 'your-public-anon-key';     // <-- Thay bằng anon key
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  async function sendTelegramID() {
    const telegram_id = document.getElementById('telegram_id_input').value.trim();
    if (!telegram_id) {
      alert('Vui lòng nhập Telegram ID');
      return;
    }

    // Kiểm tra nếu telegram_id đã tồn tại
    const { data: existing, error: fetchError } = await supabase
      .from('your_table_name')  // <-- Thay bằng tên bảng của anh
      .select('telegram_id')
      .eq('telegram_id', telegram_id)
      .maybeSingle();

    if (fetchError) {
      alert('Lỗi kiểm tra ID: ' + fetchError.message);
      return;
    }

    if (existing) {
      alert('Telegram ID này đã tồn tại!');
      return;
    }

    // Nếu chưa có, chèn mới
    const { data, error } = await supabase
      .from('your_table_name')
      .insert([{ telegram_id: telegram_id }]);

    if (error) {
      alert('Lỗi khi gửi ID: ' + error.message);
    } else {
      alert('Đã gửi thành công!');
      fetchTelegramIDs();
      document.getElementById('telegram_id_input').value = ''; // Xóa input sau khi gửi
    }
  }

  async function fetchTelegramIDs() {
    const { data, error } = await supabase
      .from('your_table_name') // <-- Thay bằng tên bảng
      .select('telegram_id');

    if (error) {
      alert('Lỗi khi lấy danh sách ID: ' + error.message);
    } else {
      const tbody = document.getElementById('telegram_ids_table').querySelector('tbody');
      tbody.innerHTML = '';
      data.forEach((item, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${index + 1}</td><td>${item.telegram_id}</td>`;
        tbody.appendChild(tr);
      });
    }
  }

  // Khi mở trang sẽ tự load danh sách
  fetchTelegramIDs();
</script>

</body>
</html>
